server:
  port: 8080

spring:
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
  jpa:
    hibernate:
      ddl-auto: ${SPRING_JPA_HIBERNATE_DDL_AUTO}
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
  aop:
    auto: true
    proxy-target-class: true

logging:
  level:
    com.example.demo: DEBUG
    org.springframework.web: INFO
#  file:
#    path: logs/

logbook:
  format.style: http
  obfuscate:
    headers:
      - Authorization
      - X-API-Key
    parameters:
      - password
      - secret
      - creditCard
      - cardNumber
  write:
    chunk-size: 1000

resilience4j:  # Cấu hình circuit breaker
  circuitbreaker:
    configs:
      default:
        registerHealthIndicator: true  # Đăng ký health indicator
    instances:
      example:
        registerHealthIndicator: true  # Đăng ký health indicator cho instance cụ thể
        slidingWindowSize: 10  # Số lượng request trong cửa sổ trượt
        failureRateThreshold: 50  # Ngưỡng tỷ lệ lỗi (%)
        waitDurationInOpenState: 10000  # Thời gian chờ ở trạng thái mở (ms)
        permittedNumberOfCallsInHalfOpenState: 3  # Số lượng request cho phép ở trạng thái nửa mở
        slowCallRateThreshold: 50  # Ngưỡng tỷ lệ request chậm (%)
        slowCallDurationThreshold: 2000  # Ngưỡng thời gian xem là request chậm (ms)
        minimumNumberOfCalls: 10  # Số lượng request tối thiểu để đánh giá
        slidingWindowType: COUNT_BASED  # Loại cửa sổ trượt dựa trên số lượng
      bank-a:
        registerHealthIndicator: true  # Đăng ký health indicator cho instance cụ thể
        slidingWindowSize: 10  # Số lượng request trong cửa sổ trượt
        failureRateThreshold: 50  # Ngưỡng tỷ lệ lỗi (%)
        waitDurationInOpenState: 10000  # Thời gian chờ ở trạng thái mở (ms)
        permittedNumberOfCallsInHalfOpenState: 3  # Số lượng request cho phép ở trạng thái nửa mở
        slowCallRateThreshold: 50  # Ngưỡng tỷ lệ request chậm (%)
        slowCallDurationThreshold: 2000  # Ngưỡng thời gian xem là request chậm (ms)
        minimumNumberOfCalls: 10  # Số lượng request tối thiểu để đánh giá
        slidingWindowType: COUNT_BASED  # Loại cửa sổ trượt dựa trên số lượng
      bank-b:
        registerHealthIndicator: true  # Đăng ký health indicator cho instance cụ thể
        slidingWindowSize: 10  # Số lượng request trong cửa sổ trượt
        failureRateThreshold: 20  # Ngưỡng tỷ lệ lỗi (%)
        waitDurationInOpenState: 10000  # Thời gian chờ ở trạng thái mở (ms)
        permittedNumberOfCallsInHalfOpenState: 3  # Số lượng request cho phép ở trạng thái nửa mở
        slowCallRateThreshold: 50  # Ngưỡng tỷ lệ request chậm (%)
        slowCallDurationThreshold: 2000  # Ngưỡng thời gian xem là request chậm (ms)
        minimumNumberOfCalls: 10  # Số lượng request tối thiểu để đánh giá
        slidingWindowType: COUNT_BASED  # Loại cửa sổ trượt dựa trên số lượng
    metrics:
      enabled: true

  retry:
    instances:
      example:
        maxAttempts: 3  # Số lần thử lại tối đa
        waitDuration: 1s  # Thời gian chờ giữa các lần thử lại

  bulkhead:
    instances:
      example:
        maxConcurrentCalls: 10  # Số lượng request đồng thời tối đa được phép xử lý

  timelimiter:
    instances:
      example:
        timeoutDuration: 2s  # Thời gian timeout cho mỗi request

  ratelimiter:
    instances:
      example:
        limitForPeriod: 10  # Số lượng request tối đa trong một khoảng thời gian
        limitRefreshPeriod: 1s  # Khoảng thời gian để reset số lượng request
        timeoutDuration: 1s  # Thời gian timeout khi đạt giới hạn request
